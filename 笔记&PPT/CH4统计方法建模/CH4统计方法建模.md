# CH4统计方法建模

## 4.5方差分析

在科学研究中，经常需要分析各种因素对实验指标是否有显著影响，要解决这个问题，一方面是要设计一个实验，使其充分反映各因素的作用，并力求试验次数尽可能少；另一方面要对实验结果的数据进行合理的分析。

### 单因素方差分析

仅考虑一个因素A对于实验指标有无显著影响，可令A取r个值：$A_1,A_2,...,A_r$,称为单因素试验，其结果$x_{ij}$如下：
|序号|1|2|...|$n_i$|
|-|-|-|-|-|
|$A_1$|$x_{11}$|$x_{12}$|...|$x_{1n_i}$|
|$A_2$|$x_{21}$|$x_{22}$|...|$x_{2n_i}$|
|...|...|...|...|...|
|$A_r$|$x_{r1}$|$x_{r2}$|...|$x_{rn_i}$|
假设在$A_i$下的数据$x_{i1},x_{i2},...,x_{in_i}$来自$X_i$~$N(\mu_i,\sigma^2)$，检验如下假设：
$H_0:\mu_1=\mu_2=...=\mu_r,H_1:\mu_1,\mu_2,...,\mu_r不全相等$
检验统计量为：
$F=\frac{\frac{S_A}{r-1}}{\frac{S_e}{n-r}}$~$F(r-1,n-r)$
上式中，
$S_A=\sum_{i=1}^{r}\sum_{j=1}^{n_i}(\overline{x_i}-\overline{x})^2=\sum_{i=1}^{r}(\overline{x_i}-\overline{x})^2$，称为组间差平方和。
$S_e=\sum_{i=1}^{r}\sum_{j=1}^{n_i}(x_{ij}-\overline{x_i})^2$，称为组内差平方和。
其中，$n=\sum_{i=1}^{r}n_i,\\\overline{x_i}=\frac{1}{n}\sum_{j=1}^{n_i}x_{ij},\\\overline{x}=\frac{1}{n}\sum_{i=1}^{r}\sum_{j=1}^{n_i}x_{ij}$
对于给定的显著性水平$\alpha(\alpha=0.0 or 0.05)$，如果$F>F_\alpha(r-1,n-r)$，则拒绝$H_0$，即认为A对实验指标有显著影响。
在实际计算时，可以先对原始数据做如下处理：
$x_{ij}'=\frac{x_{ij}-a}{b}$，不会影响F值的大小。
通常采用如下简便记法：
$T_i=\sum_{j=1}^{n_i}x_{ij} (i=1,2,...,r)$
$T=\sum_{i=1}^{r}\sum_{j=1}^{n_i}x_{ij}$
则有：
$S_A=\sum_{i=1}^{r}\frac{T_i^2}{n_i}-\frac{T^2}{n}$
$S_e=\sum_{i=1}^{r}\sum_{j=1}^{n_i}x_{ij}^2-\sum_{i=1}^{r}\frac{T_i^2}{n_i}$
可得方差分析表：
|方差来源|平方和|自由度|F值|检验p值|
|-|-|-|-|-|
|因素A|$S_A$|r-1|$F=\frac{S_A/(r-1)}{S_e/(n-r)}$||
|误差E|$S_e$|n-r|||
|总和|$S_A+S_e$|n-1|||

### 双因素方差分析

同时考察两个因素A、B对于试验指标有无显著影响，可以让A取r个水平：$A_1,A_2,...,A_r$，让B取r个水平：$B_1,B_2,...,B_r$，在各种水平配合$(A_i,B_j)$下进行实验，称为双因素实验。

#### 1.无交互作用得双因素方差分析

在没中过水平配合$(A_i,B_j)$下做实验，称为无交互作用得双因素实验，检验结果$x_{ij}$如下表：
|因素|$B_1$|$B_2$|...|$B_S$|
|-|-|-|-|-|
|$A_1$|$x_{11}$|$x_{12}$|...|$x_{1s}$|
|$A_2$|$x_{21}$|$x_{22}$|...|$x_{2s}$|
|...|...|...|...|...|
|$A_r$|$x_{r1}$|$x_{r2}$|...|$x_{rs}$|
并假设在水平配合$(A_i,B_j)$下的数据$x_{ij}$来自整体$X_{ij}$~$N(\mu_{ij},\sigma^2),(i=1,2,...,r;j=1,2,...,s)$
检验如下假设：
$H_{0A}:\mu_1.=\mu_2.=...=\mu_r.,H_{1A}:\mu_1.,\mu_2.,...,\mu_r.不全相等$
$H_{0B}:\mu_{.1}=\mu_{.2}=...=\mu_{.r},H_{1B}:\mu_{.1},\mu_{.2},...,\mu_{.r}不全相等$
检验统计量为：
$F_A=\frac{\frac{S_A}{r-1}}{\frac{S_e}{n-r}}$~$F(r-1,n-r)$
$F_B=\frac{\frac{S_B}{r-1}}{\frac{S_e}{n-r}}$~$F(r-1,n-r)$
上式中，
$S_A=\sum_{i=1}^{r}\sum_{j=1}^{s}(\overline{x_i.}-\overline{x})^2=\sum_{i=1}^{r}(\overline{x_i.}-\overline{x})^2$，称为A的组间差平方和。
$S_B=\sum_{i=1}^{r}\sum_{j=1}^{s}(\overline{x_{.j}}-\overline{x})^2=\sum_{i=1}^{s}(\overline{x_{.j}}-\overline{x})^2$，称为B的组间差平方和。
$S_e=\sum_{i=1}^{r}\sum_{j=1}^{n_i}(x_{ij}-\overline{x_i})^2$，称为组内差平方和。
其中，$\overline{x_i.}=\frac{1}{s}\sum_{j=1}^{s}x_{ij},\\\overline{x_{.j}}=\frac{1}{r}\sum_{j=1}^{r}x_{ij},\\\overline{x}=\frac{1}{rs}\sum_{i=1}^{r}\sum_{j=1}^{s}x_{ij}$
对于给定的显著性水平$\alpha(\alpha=0.0 or 0.05)$，
如果$F_A>F_\alpha(r-1,(r-1))(s-1))$，则拒绝$H_{0A}$，即认为A对实验指标有显著影响。
如果$F_B>F_\alpha(r-1,(r-1)(s-1)))$，则拒绝$H_{0B}$，即认为B对时延指标有显著影响。
在实际计算时，可以先对原始数据做如下处理：
$x_{ij}'=\frac{x_{ij}-a}{b}$，不会影响$F_A、F_B$值的大小。
可得方差分析表：
|方差来源|平方和|自由度|F值|检验p值|
|-|-|-|-|-|
|因素A|$S_A$|r-1|$F=\frac{S_A/(r-1)}{S_e/(n-r)}$||
|因素B|$S_B$|r-1|$F=\frac{S_A/(r-1)}{S_e/(n-r)}$||
|误差E|$S_e$|(r-1)(s-1)|||
|总和|$S_A+S_B+S_e$|rs-1|||